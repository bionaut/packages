{"version":3,"file":"modal-hub.stories-d648c2f4.js","sources":["../../../../packages/modal-hub/src/lib/modal-hub-context.tsx"],"sourcesContent":["import React, {\n  FC,\n  PropsWithChildren,\n  ReactElement,\n  useCallback,\n  useContext,\n  useState,\n  useEffect,\n} from 'react'\n\nimport {\n  ModalHubActions,\n  ModalHubContextValue,\n  ModalHubState,\n  UseModalHub,\n} from './modal-hub-types'\n\nexport const modalHubContext = React.createContext<ModalHubContextValue>(\n  [] as any,\n)\n\nconst Empty: FC = () => {\n  return null\n}\n\nexport const ModalHubProvider: FC<PropsWithChildren<unknown>> = ({\n  children,\n}) => {\n  const [state, updateState] = useState<ModalHubState>({})\n  const { active } = state\n\n  const renderModal = (modalComponent: ReactElement) => {\n    updateState(() => {\n      return {\n        active: modalComponent,\n      }\n    })\n  }\n\n  const removeModal = () => {\n    updateState(() => {\n      return {\n        active: undefined,\n      }\n    })\n  }\n\n  const actions: ModalHubActions = {\n    renderModal,\n    removeModal,\n  }\n\n  const component = active || <Empty />\n\n  return (\n    <modalHubContext.Provider value={[state, actions]}>\n      <>\n        {children}\n        {component}\n      </>\n    </modalHubContext.Provider>\n  )\n}\n\nexport const useModalHub: UseModalHub = (modal, props) => {\n  const [isOpen, setOpen] = useState(false)\n  const [currentStep, setCurrentStep] = useState(props?.currentStep || 0)\n  const [, { removeModal, renderModal }] = useContext(modalHubContext)\n\n  const Component = modal\n\n  const close = useCallback(() => {\n    setOpen(false)\n  }, [])\n\n  useEffect(() => {\n    if (isOpen) {\n      renderModal(\n        <Component\n          {...(props as any)}\n          onClose={close}\n          currentStep={currentStep}\n          nextStep={() => setCurrentStep((prev) => prev + 1)}\n          prevStep={() => setCurrentStep((prev) => Math.max(prev - 1, 0))}\n        />,\n      )\n    } else {\n      removeModal()\n    }\n  }, [Component, close, props, renderModal, currentStep, isOpen, removeModal])\n\n  const open = useCallback(() => {\n    setCurrentStep(props?.currentStep || 0)\n    setOpen(true)\n  }, [props?.currentStep])\n\n  const openWithProps = useCallback(\n    (overrideProps?: Partial<typeof props>) => {\n      setCurrentStep(overrideProps?.currentStep || props?.currentStep || 0)\n      setOpen(true)\n    },\n    [props?.currentStep],\n  )\n\n  return {\n    isOpen,\n    close,\n    open,\n    openWithProps,\n    currentStep,\n  }\n}\n"],"names":["modalHubContext","React","Empty","ModalHubProvider","children","state","updateState","useState","active","actions","modalComponent","component","jsx","jsxs","Fragment","useModalHub","modal","props","isOpen","setOpen","currentStep","setCurrentStep","removeModal","renderModal","useContext","Component","close","useCallback","useEffect","prev","open","openWithProps","overrideProps"],"mappings":"sGAiBO,MAAAA,EAAAC,EAAA,cAA8B,CAAA,CAErC,EAEAC,EAAA,IACE,KAGKC,EAAA,CAAA,CAA0D,SAAAC,CAEjE,IAAA,CACE,KAAA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,SAAA,CAAA,CAAA,EACA,CAAA,OAAAC,CAAA,EAAAH,EAkBAI,EAAA,CAAiC,YAhBjCC,GAAA,CACEJ,EAAA,KACE,CAAO,OAAAI,CACG,EACV,CACD,EAYD,YATF,IAAA,CACEJ,EAAA,KACE,CAAO,OAAA,MACG,EACV,CACD,CAKD,EAGFK,EAAAH,GAAAI,EAAAV,EAAA,CAAA,CAAA,EAEA,OAAAU,EAAAZ,EAAA,SAAA,CAAA,MAAA,CAAAK,EAAAI,CAAA,EAAA,SAAAI,EAAAC,EAAA,CAAA,SAAA,CAGOV,EAAAO,CACA,CAAA,CAAA,CAAA,CAAA,CAIT,EAEOI,EAAA,CAAAC,EAAAC,IAAA,CACL,KAAA,CAAAC,EAAAC,CAAA,EAAAZ,EAAA,SAAA,EAAA,EACA,CAAAa,EAAAC,CAAA,EAAAd,EAAA,UAAAU,GAAA,YAAAA,EAAA,cAAA,CAAA,EACA,CAAA,CAAA,CAAA,YAAAK,EAAA,YAAAC,CAAA,CAAA,EAAAC,EAAAA,WAAAxB,CAAA,EAEAyB,EAAAT,EAEAU,EAAAC,EAAAA,YAAA,IAAA,CACER,EAAA,EAAA,CAAa,EAAA,CAAA,CAAA,EAGfS,EAAAA,UAAA,IAAA,CACEV,EACEK,EAAAX,EACEa,EAAC,CAAA,GAAAR,EACM,QAAAS,EACI,YAAAN,EACT,SAAA,IAAAC,EAAAQ,GAAAA,EAAA,CAAA,EACiD,SAAA,IAAAR,EAAAQ,GAAA,KAAA,IAAAA,EAAA,EAAA,CAAA,CAAA,CACa,CAAA,CAChE,EAGFP,GACF,EAAA,CAAAG,EAAAC,EAAAT,EAAAM,EAAAH,EAAAF,EAAAI,CAAA,CAAA,EAGF,MAAAQ,EAAAH,EAAAA,YAAA,IAAA,CACEN,GAAAJ,GAAA,YAAAA,EAAA,cAAA,CAAA,EACAE,EAAA,EAAA,CAAY,EAAA,CAAAF,GAAA,YAAAA,EAAA,WAAA,CAAA,EAGdc,EAAAJ,EAAA,YAAsBK,GAAA,CAElBX,GAAAW,GAAA,YAAAA,EAAA,eAAAf,GAAA,YAAAA,EAAA,cAAA,CAAA,EACAE,EAAA,EAAA,CAAY,EACd,CAAAF,GAAA,YAAAA,EAAA,WAAA,CACmB,EAGrB,MAAA,CAAO,OAAAC,EACL,MAAAQ,EACA,KAAAI,EACA,cAAAC,EACA,YAAAX,CACA,CAEJ;;;;;;;"}